var nmgr=window.nmgr||{};jQuery(function(a){nmgr.selectors={modal:"#nmgr-modal"},nmgr.block=function(t){nmgr.is_blocked(t)||a(t).addClass("is-blocked").block({message:null,overlayCSS:{backgroundColor:"#fff"},css:{backgroundColor:"transparent",border:"none"}})},nmgr.unblock=function(t){a(t).removeClass("is-blocked").unblock()},nmgr.is_blocked=function(t){return a(t).is("is-blocked")||a(t).parents("is-blocked").length},nmgr.scroll_to=function(t){a(t).length&&(nmgr.is_in_modal(t)?a("#nmgr-modal").animate({scrollTop:0}):a("html, body").animate({scrollTop:a(t).offset().top-100},1e3))},nmgr.go_to=function(t){-1===t.indexOf("https://")||-1===t.indexOf("http://")?window.location=t:window.location=decodeURI(t)},nmgr.show_notice=function(t,e){$target=a(".woocommerce-notices-wrapper:first")||a(".nmgr-cart-item-add-to-cart").closest(".woocommerce"),!0===e&&nmgr.is_in_modal()&&($target=a(nmgr.selectors.modal).find(".modal-body")),$target.length&&(nmgr.remove_notice(),a(t).addClass("nmgr-notice").prependTo($target),nmgr.scroll_to($target))},nmgr.remove_notice=function(t){var e=".woocommerce-error, .woocommerce-message, .woocommerce-info";(void 0!==t?a(t).find(e):a(e)).remove()},nmgr.refresh_cart_fragments=function(){a.post(nmgr_global_params.ajax_url,{action:"nmgr_get_cart_fragments"},function(t){t&&t.fragments&&a(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash])})},nmgr.make_table_responsive=function(t,e){e=e||600;t=a(t=t||".nmgr-table");t.width()>e?t.addClass("responsive"):t.removeClass("responsive")},nmgr.tiptip=function(){a(".nmgr-tip").each(function(){var t=a(this),e={},n=t.find("title");t.attr("data-tiptip-position")&&(e.defaultPosition=t.attr("data-tiptip-position")),t.is("svg")&&(e.content=function(){if(n.length&&n.attr("data-title"))return n.text(""),n.attr("data-title")}),t.tipTip(e)})},nmgr.tiptip(),nmgr.modal={},document.querySelector(nmgr.selectors.modal)&&(nmgr.modal=new BSN.Modal(nmgr.selectors.modal)),nmgr.modal.data={},nmgr.is_in_modal=function(t){return t?a(nmgr.selectors.modal).hasClass("show")&&0<a(t).closest(nmgr.selectors.modal).length:a(nmgr.selectors.modal).hasClass("show")},nmgr.modal.has_content=function(t){return 0<a(nmgr.selectors.modal).find(t).length},nmgr.modal.show_or_update=function(){nmgr.is_in_modal()?(a(nmgr.selectors.modal).first().trigger("update.bs.modal"),nmgr.modal.update()):(a(nmgr.selectors.modal).first().trigger("show.bs.modal"),nmgr.modal.show())},nmgr.modal.set_content=function(t){nmgr.modal.setContent(t),a(nmgr.selectors.modal).first().trigger("set_content.bs.modal")},nmgr.init_datepicker=function(n){n=n||"#nmgr_event_date";var i="nmgr-datepicker",t={dateFormat:nmgr_global_params.date_format};nmgr_global_params.style_datepicker&&(t=Object.assign(t,{beforeShow:function(t,e){e.id===n.replace(/^#/,"")&&e.dpDiv.addClass(i)},onClose:function(t,e){e.id===n.replace(/^#/,"")&&e.dpDiv.removeClass(i)}})),a(n).datepicker(t)},nmgr.stupidtable=function(t){a(t).stupidtable(),a(t).on("aftertablesort",this.add_arrow),a(t).find("th").on("mouseenter",this.show_default_arrow),a(t).find("th").on("mouseleave",this.remove_default_arrow)},nmgr.stupidtable.prototype.add_arrow=function(t,e){var n=a(this).find("th"),i="asc"===e.direction?"&uarr;":"&darr;",e=e.column;n.find(".nmgr-arrow").remove(),n.eq(e).append('<span class="nmgr-arrow">'+i+"</span>")},nmgr.stupidtable.prototype.show_default_arrow=function(){a(this).hasClass("sortable")&&0===a(this).find(".nmgr-arrow").length&&a(this).append('<span class="nmgr-arrow hover">&uarr;</span>')},nmgr.stupidtable.prototype.remove_default_arrow=function(){a(this).find(".nmgr-arrow.hover").remove()},a(document.body).on("nmgr_added_to_cart nmgr_removed_from_wishlist",nmgr.refresh_cart_fragments)}),jQuery(function(g){if("undefined"==typeof nmgr_admin_params)return!1;nmgr.mago={container:"#nmgr-mago",template:!1,self:"",el:"",identifier:"",data:{},init:function(){this.el=document.querySelector(this.container),this.el&&(this.template||(this.template=this.el.cloneNode(!0)),this.self=new BSN.Modal(this.container),g(document.body).on("click","[data-dialog-content]",this.showForDataAttr),this.el.addEventListener("hidden.bs.modal",this.reset,!1))},showForDataAttr:function(t){var e=t.currentTarget.dataset.dialogContent.replace("#",""),n=document.getElementById(e);n&&(nmgr.mago.setContent(n.innerHTML,e),nmgr.mago.setup(t.target),nmgr.mago.show(),t.preventDefault())},setup:function(t){t=t instanceof Element?t.dataset:t;t.dialogWidth&&"small"===t.dialogWidth&&this.el.querySelector(".modal-dialog").classList.remove("modal-lg"),t.dialogTitle&&this.setTitle(t.dialogTitle),t.dialogBody&&this.setBody(t.dialogBody),t.dialogClass&&"string"==typeof t.dialogClass&&this.el.classList.add(t.dialogClass)},update:function(){g(this.container).first().trigger("update.bs.modal"),this.self.update()},show:function(){g(this.container).first().trigger("show.bs.modal"),this.self.show()},hide:function(){this.self.hide()},showOrUpdate:function(){this.hasContent()?this.update():this.show()},setContent:function(t,e){this.self.setContent(t),"string"==typeof e&&(this.el.classList.add(e),this.identifier=e),g(this.container).first().trigger("set_content.bs.modal")},setTitle:function(t){this.el.querySelector(".modal-title").innerHTML=t},setBody:function(t){this.el.querySelector(".modal-body").innerHTML=t},reset:function(){this.classList.value=nmgr.mago.template.classList.value,this.innerHTML=nmgr.mago.template.innerHTML},hasContent:function(t){return t?this.el.classList.contains("show")&&null!==this.el.querySelector(t):this.el.classList.contains("show")}},nmgr.mago.init(),nmgr.items={container:"#nmgr-items",wishlist:{},init:function(){new nmgr.stupidtable(".nmgr-items-table"),nmgr.make_table_responsive(".nmgr-items-table"),this.checkValidation(),g(window).on("resize",function(){nmgr.make_table_responsive(".nmgr-items-table")}),g(document.body).on("change","#nmgr-items td.quantity input.quantity",this.quantity_changed).on("click","#nmgr-items a.edit-wishlist-item",this.edit_item).on("click","#nmgr-items a.delete-wishlist-item",this.pre_delete_item).on("click","#nmgr-items button.save-action",this.save_items).on("click","#nmgr-items .nmgr-add-items-action",this.add_items_action).on("change",".nmgr-product-search",this.new_add_items_row).on("click",".nmgr-add-items-dialog .nmgr-add",this.add_items).on("nmgr_wishlist_created nmgr_shipping_reloaded",this.reload).on("removed_from_cart",nmgr.remove_notice).on("click",".nmgr_add_to_cart_button",this.add_single_product_to_cart).on("nmgr_added_to_cart nmgr_removed_from_wishlist",nmgr.refresh_cart_fragments).on("nmgr_tab_shown",this.maybe_make_table_responsive).on("nmgr_add_to_cart_response",this.remove_loading_animation),nmgr.mago.el.addEventListener("show.bs.modal",this.init_add_items_form,!1)},reload:function(t,e){var n=parseInt(g(nmgr.items.container).attr("data-wishlist-id")),i=void 0!==e&&e.id?e.id:n;0!==n&&void 0!==e&&e.id&&n!==parseInt(e.id)||(i={action:"nmgr_load_items",wishlist_id:parseInt(i),nmgr_global:JSON.stringify(nmgr_global_params.global),_wpnonce:g(nmgr.items.container).attr("data-nonce")},nmgr.block(nmgr.items.container),g.post(nmgr_global_params.ajax_url,i,function(t){g(nmgr.items.container).replaceWith(t),nmgr.items.wishlist=e,nmgr.items.reloaded()}))},reloaded:function(){g(document.body).trigger("nmgr_items_reloaded",this.wishlist),new nmgr.stupidtable(".nmgr-items-table"),this.checkValidation(),nmgr.make_table_responsive(".nmgr-items-table")},checkValidation:function(){g("#nmgr-items input").on("invalid",function(){g(this).closest("tr").find(".edit").show(),g(this).closest("tr").find(".view").hide(),g("#nmgr-items button.save-action").attr("data-reload",!0)})},quantity_changed:function(){var t=g(this).closest("tr.item"),e=g(this).val(),n=g("input.item_total",t),t=g(".cost",t).attr("data-sort-value");n.val(t*e)},edit_item:function(){return g(this).closest("tr").find(".view").toggle(),g(this).closest("tr").find(".edit").toggle(),g("#nmgr-items button.save-action").attr("data-reload",!0),!1},pre_delete_item:function(t){var e;t.preventDefault(),window.confirm(g(this).attr("data-notice"))&&(e=[g(this).closest("tr.item").attr("data-wishlist_item_id")],t=g(nmgr.items.container).attr("data-wishlist-id"),nmgr.items.delete_items(e,t))},delete_items:function(t,e){nmgr.block(nmgr.items.container);e={wishlist_item_ids:t,action:"nmgr_delete_items",wishlist_id:e,_wpnonce:nmgr_global_params.nonce,nmgr_global:JSON.stringify(nmgr_global_params.global)};return"true"===g("#nmgr-items button.save-action").attr("data-reload")&&(e.items=g(".nmgr-items-table :input[name]").serialize()),g.post(nmgr_global_params.ajax_url,e,function(t){t.success?(nmgr.items.wishlist=t.wishlist,g(nmgr.items.container).replaceWith(g(t.template)),nmgr.items.reloaded(),g(document.body).trigger("nmgr_removed_from_wishlist",t)):t.error&&t.notice&&window.alert(t.notice)}),!1},save_items:function(){var t={items:g(".nmgr-items-table :input[name]").serialize(),action:"nmgr_save_items",wishlist_id:g(nmgr.items.container).attr("data-wishlist-id"),_wpnonce:g(nmgr.items.container).attr("data-nonce"),nmgr_global:JSON.stringify(nmgr_global_params.global)};return nmgr.block(nmgr.items.container),g.post(nmgr_global_params.ajax_url,t,function(t){t.success&&(nmgr.items.wishlist=t.data.wishlist,g(nmgr.items.container).replaceWith(g(t.data.html)),nmgr.items.reloaded()),nmgr.unblock(nmgr.items.container)}),!1},add_items_action:function(){g(this).attr("data-url")&&nmgr.go_to(g(this).attr("data-url"))},init_add_items_form:function(){var t="nmgr-add-items-dialog";this.classList.contains(t)&&(nmgr.items.reset_add_items_form("."+t),g(document.body).trigger("nmgr-select2-init"))},reset_add_items_form:function(t){void 0!==t&&(g(t).find("tr.added-row").remove(),g(t).find("form").trigger("reset").find(":input").each(function(){g(this).is(".nmgr-product-search")&&g(this).val("")}))},new_add_items_row:function(){var t,e;g(this).closest("tr").is(":last-child")&&(e=(t=g(this).closest("table").find("tbody")).find("tr").length,e=t.data("row").replace(/\[0\]/g,"["+e+"]"),t.append('<tr class="added-row">'+e+"</tr>"),g(document.body).trigger("nmgr-select2-init"))},add_items:function(){var t=g(this).closest(".nmgr-add-items-dialog").find("table tbody").find("tr"),i=[];g(t).each(function(){var t=g(this).find(':input[name="item_id"]').val(),e=g(this).find(':input[name="item_qty"]').val(),n=g(this).find(':input[name="item_fav"]').val();i.push({id:t,qty:e||1,fav:n})}),nmgr.mago.self.hide(),nmgr.block(nmgr.items.container);t={action:"nmgr_add_item",wishlist_id:g(nmgr.items.container).attr("data-wishlist-id"),nmgr_global:JSON.stringify(nmgr_global_params.global),data:i};"true"===g("#nmgr-items button.save-action").attr("data-reload")&&(t.items=g(".nmgr-items-table :input[name]").serialize()),g.ajax({type:"POST",url:nmgr_global_params.ajax_url,data:t,dataType:"json",success:function(t){t.success?(g(nmgr.items.container).replaceWith(t.data.html),nmgr.items.reloaded()):(nmgr.unblock(nmgr.items.container),window.alert(t.data.error))}})},add_single_product_to_cart:function(t){var e=g(this),n={},i=e.closest(".nmgr-add-to-cart-form");if(!e.is(".nmgr_ajax_add_to_cart"))return!0;t.preventDefault(),g(i.serializeArray()).each(function(t,e){n[e.name]=e.value}),e.removeClass("added").addClass("loading"),nmgr.items.add_to_cart([n])},add_to_cart:function(t){t={action:"nmgr_add_to_cart",nmgr_items:t,nmgr_global:JSON.stringify(nmgr_global_params.global)};g.post(nmgr_global_params.ajax_url,t,function(t){t.success&&t.redirect_url?window.location=t.redirect_url:(g(".woocommerce-error, .woocommerce-message, .woocommerce-info").remove(),g(document.body).trigger("nmgr_add_to_cart_response",t),t.notice&&nmgr.show_notice(t.notice,!0),t.success&&g(document.body).trigger("nmgr_added_to_cart",[t.items_data||""]))})},remove_loading_animation:function(t,e){void 0!==e&&e.items_data&&g(nmgr.items.container)&&e.items_data.forEach(function(t){g(nmgr.items.container).find('tr[data-wishlist_item_id="'+t.wishlist_item_id+'"] .nmgr_add_to_cart_button').removeClass("loading")})},maybe_make_table_responsive:function(t,e){g(e).is("#nmgr-tab-items")&&nmgr.make_table_responsive(".nmgr-items-table")}},nmgr.items.init();var t={init:function(){try{g(document.body).on("nmgr-select2-init",this.activate_select2).trigger("nmgr-select2-init")}catch(t){window.console.log(t)}},activate_select2:function(){t.select2_user_search(),t.select2_product_search()},select2_product_search:function(){g(":input.nmgr-product-search").each(function(){var t={allowClear:!!g(this).data("allow_clear"),placeholder:g(this).data("placeholder"),minimumInputLength:g(this).data("minimum_input_length")?g(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:nmgr_global_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:"nmgr_json_search_products",security:nmgr_admin_params.search_products_nonce,exclude:g(this).data("exclude"),exclude_type:g(this).data("exclude_type"),include:g(this).data("include"),limit:g(this).data("limit"),display_stock:g(this).data("display_stock")}},processResults:function(t){var n=[];return t&&g.each(t,function(t,e){n.push({id:t,text:e})}),{results:n}},cache:!0}};g(this).select2(t)})},select2_user_search:function(){g(":input.nmgr-user-search").each(function(){var t={allowClear:!!g(this).data("allow_clear"),placeholder:g(this).data("placeholder"),minimumInputLength:g(this).data("minimum_input_length")?g(this).data("minimum_input_length"):"1",escapeMarkup:function(t){return t},ajax:{url:nmgr_global_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:"nmgr_json_search_users",security:nmgr_admin_params.search_users_nonce,exclude:g(this).data("exclude")}},processResults:function(t){var n=[];return t&&g.each(t,function(t,e){n.push({id:t,text:e})}),{results:n}},cache:!0}};g(this).select2(t)})}};t.init();var e={selector:{ship_to:"#nmgr_ship_to_account_address",user_id:"#nmgr_user_id"},init:function(){if("undefined"==typeof nmgr_admin_params)return!1;this.maybe_hide_ship_to_account_address_field(),this.toggle_fieldsets(),g(this.selector.user_id).on("change",this.maybe_hide_ship_to_account_address_field),g(this.selector.ship_to).on("change",this.maybe_toggle_fieldsets)},maybe_hide_ship_to_account_address_field:function(){isNaN(g(e.selector.user_id).val())?g(e.selector.ship_to).prop("disabled",!0):g(e.selector.ship_to).prop("disabled",!1)},maybe_toggle_fieldsets:function(){if(g(this).is(":checked")){if(!g(e.selector.user_id).val())return alert(nmgr_admin_params.i18n_select_user),g(this).prop("checked",!1),!1;if(!window.confirm(nmgr_admin_params.i18n_use_account_shipping_address_text))return g(this).prop("checked",!1),!1}e.toggle_fieldsets()},toggle_fieldsets:function(){g(this.selector.ship_to).is(":checked")?(g(".account-shipping-address").slideDown(),g(".wishlist-shipping-address").hide()):(g(".account-shipping-address").slideUp(),g(".wishlist-shipping-address").slideDown())}};e.init(),nmgr.init_datepicker();var _={states:null,init:function(){"undefined"!=typeof nmgr_admin_params&&void 0!==nmgr_admin_params.countries&&(this.states=g.parseJSON(nmgr_admin_params.countries.replace(/&quot;/g,'"'))),g(".js_field-country").selectWoo().change(this.change_country),g(".js_field-country").trigger("change",[!0]),g(document.body).on("change","select.js_field-state",this.change_state)},change_country:function(t,e){var n,i,a,r,s,o,m,d,l,c;void 0===e&&(e=!1),null!==_.states&&(l=(n=g(this)).val(),a=(i=n.parents("div.nmgr-shipping-fields").find(":input.js_field-state")).parent(),r=i.attr("name"),s=i.attr("id"),o=n.data("woocommerce.stickState-"+l)?n.data("woocommerce.stickState-"+l):i.val(),m=i.attr("placeholder"),e&&n.data("woocommerce.stickState-"+l,o),a.show().find(".select2-container").remove(),g.isEmptyObject(_.states[l])?(c=g('<input type="text" />').prop("id",s).prop("name",r).prop("placeholder",m).addClass("js_field-state").val(""),i.replaceWith(c)):(d=_.states[l],l=g('<option value=""></option>').text(nmgr_admin_params.i18n_select_state_text),c=g("<select></select>").prop("id",s).prop("name",r).prop("placeholder",m).addClass("js_field-state select short").append(l),g.each(d,function(t){t=g("<option></option>").prop("value",t).text(d[t]);c.append(t)}),c.val(o),i.replaceWith(c),c.show().selectWoo().hide().change()))},change_state:function(){var t=g(this),e=t.val(),n=t.parents("div.nmgr-shipping-fields").find(":input.js_field-country"),t=n.val();n.data("woocommerce.stickState-"+t,e)}};_.init(),function(){var t=document.querySelectorAll("tr.type-nm_gift_registry td.column-author");if(t.length)for(var e=0;e<t.length;e++)t[e].innerText||(t[e].innerHTML='<div class="nmgr-post-author">'+nmgr_admin_params.i18n_guest_text+"</div>")}()});