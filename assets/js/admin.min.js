var nmgr=window.nmgr||{};jQuery(function(i){nmgr.selectors={modal:"#nmgr-modal"},nmgr.block=function(t){nmgr.is_blocked(t)||i(t).addClass("is-blocked").block({message:null,overlayCSS:{backgroundColor:"#fff"},css:{backgroundColor:"transparent",border:"none"}})},nmgr.unblock=function(t){i(t).removeClass("is-blocked").unblock()},nmgr.is_blocked=function(t){return i(t).is("is-blocked")||i(t).parents("is-blocked").length},nmgr.scroll_to=function(t){i(t).length&&(nmgr.is_in_modal(t)?i("#nmgr-modal").animate({scrollTop:0}):i("html, body").animate({scrollTop:i(t).offset().top-100},1e3))},nmgr.go_to=function(t){-1===t.indexOf("https://")||-1===t.indexOf("http://")?window.location=t:window.location=decodeURI(t)},nmgr.show_notice=function(t,e){$target=i(".woocommerce-notices-wrapper:first")||i(".nmgr-cart-item-add-to-cart").closest(".woocommerce"),!0===e&&nmgr.is_in_modal()&&($target=i(nmgr.selectors.modal).find(".modal-body")),$target.length&&(nmgr.remove_notice(),i(t).addClass("nmgr-notice").prependTo($target),nmgr.scroll_to($target))},nmgr.remove_notice=function(t){var e=".woocommerce-error, .woocommerce-message, .woocommerce-info";(void 0!==t?i(t).find(e):i(e)).remove()},nmgr.refresh_cart_fragments=function(){i.post(nmgr_global_params.ajax_url,{action:"nmgr_get_cart_fragments"},function(t){t&&t.fragments&&i(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash])})},nmgr.make_table_responsive=function(t,e){e=e||600;t=i(t=t||".nmgr-table");t.width()>e?t.addClass("responsive"):t.removeClass("responsive")},nmgr.tiptip=function(){i(".nmgr-tip").tipTip(),i("svg.nmgr-tip").each(function(){var t=i(this),e=t.find("title");e.length&&t.tipTip({content:function(){if(e.length&&e.attr("data-title"))return e.text(""),e.attr("data-title")}})})},nmgr.tiptip(),nmgr.modal={},document.querySelector(nmgr.selectors.modal)&&(nmgr.modal=new BSN.Modal(nmgr.selectors.modal)),nmgr.modal.data={},nmgr.is_in_modal=function(t){return t?i(nmgr.selectors.modal).hasClass("show")&&0<i(t).closest(nmgr.selectors.modal).length:i(nmgr.selectors.modal).hasClass("show")},nmgr.modal.has_content=function(t){return 0<i(nmgr.selectors.modal).find(t).length},nmgr.modal.show_or_update=function(){nmgr.is_in_modal()?(i(nmgr.selectors.modal).first().trigger("update.bs.modal"),nmgr.modal.update()):(i(nmgr.selectors.modal).first().trigger("show.bs.modal"),nmgr.modal.show())},nmgr.modal.set_content=function(t){nmgr.modal.setContent(t),i(nmgr.selectors.modal).first().trigger("set_content.bs.modal")},nmgr.init_datepicker=function(a){a=a||"#nmgr_event_date";var n="nmgr-datepicker",t={dateFormat:nmgr_global_params.date_format};nmgr_global_params.style_datepicker&&(t=Object.assign(t,{beforeShow:function(t,e){e.id===a.replace(/^#/,"")&&e.dpDiv.addClass(n)},onClose:function(t,e){e.id===a.replace(/^#/,"")&&e.dpDiv.removeClass(n)}})),i(a).datepicker(t)},nmgr.stupidtable=function(t){i(t).stupidtable(),i(t).on("aftertablesort",this.add_arrow),i(t).find("th").on("mouseenter",this.show_default_arrow),i(t).find("th").on("mouseleave",this.remove_default_arrow)},nmgr.stupidtable.prototype.add_arrow=function(t,e){var a=i(this).find("th"),n="asc"===e.direction?"&uarr;":"&darr;",e=e.column;a.find(".nmgr-arrow").remove(),a.eq(e).append('<span class="nmgr-arrow">'+n+"</span>")},nmgr.stupidtable.prototype.show_default_arrow=function(){i(this).hasClass("sortable")&&0===i(this).find(".nmgr-arrow").length&&i(this).append('<span class="nmgr-arrow hover">&uarr;</span>')},nmgr.stupidtable.prototype.remove_default_arrow=function(){i(this).find(".nmgr-arrow.hover").remove()}}),jQuery(function(_){if("undefined"==typeof nmgr_admin_params)return!1;var i={container:"#nmgr-items",wishlist:{},init:function(){new nmgr.stupidtable(".nmgr-items-table"),nmgr.make_table_responsive(".nmgr-items-table"),this.checkValidation(),_(window).on("resize",function(){nmgr.make_table_responsive(".nmgr-items-table")}),_(document.body).on("change","#nmgr-items td.quantity input.quantity",this.quantity_changed).on("click","#nmgr-items a.edit-wishlist-item",this.edit_item).on("click","#nmgr-items a.delete-wishlist-item",this.delete_item).on("click","#nmgr-items button.save-action",this.save_items).on("click","#nmgr-items .nmgr-add-items-action",this.add_items_action).on("change",".nmgr-product-search",this.new_add_items_row).on("click",".nmgr-add-items .nmgr-add",this.add_items).on("nmgr_wishlist_created nmgr_shipping_reloaded",this.reload).on("removed_from_cart",nmgr.remove_notice).on("click",".nmgr_add_to_cart_button",this.add_to_cart).on("nmgr_added_to_cart nmgr_removed_from_wishlist",nmgr.refresh_cart_fragments).on("nmgr_tab_shown",this.maybe_make_table_responsive)},reload:function(t,e){var a=parseInt(_(i.container).attr("data-wishlist-id")),n=void 0!==e&&e.id?e.id:a;0!==a&&void 0!==e&&e.id&&a!==parseInt(e.id)||(n={action:"nmgr_load_items",wishlist_id:parseInt(n),nmgr_global:JSON.stringify(nmgr_global_params.global),_wpnonce:_(i.container).attr("data-nonce")},nmgr.block(i.container),_.post(nmgr_global_params.ajax_url,n,function(t){_(i.container).replaceWith(t),i.wishlist=e,i.reloaded()}))},reloaded:function(){_(document.body).trigger("nmgr_items_reloaded",this.wishlist),new nmgr.stupidtable(".nmgr-items-table"),this.checkValidation(),nmgr.make_table_responsive(".nmgr-items-table")},checkValidation:function(){_("#nmgr-items input").on("invalid",function(){_(this).closest("tr").find(".edit").show(),_(this).closest("tr").find(".view").hide(),_("#nmgr-items button.save-action").attr("data-reload",!0)})},quantity_changed:function(){var t=_(this).closest("tr.item"),e=_(this).val(),a=_("input.item_total",t),t=_(".cost",t).attr("data-sort-value");a.val(t*e)},edit_item:function(){return _(this).closest("tr").find(".view").toggle(),_(this).closest("tr").find(".edit").toggle(),_("#nmgr-items button.save-action").attr("data-reload",!0),!1},delete_item:function(){var t;return window.confirm(nmgr_global_params.i18n_delete_item_text)&&(nmgr.block(i.container),t={wishlist_item_ids:_(this).closest("tr.item").attr("data-wishlist_item_id"),action:"nmgr_delete_item",wishlist_id:_(i.container).attr("data-wishlist-id"),_wpnonce:_(i.container).attr("data-nonce"),nmgr_global:JSON.stringify(nmgr_global_params.global)},"true"===_("#nmgr-items button.save-action").attr("data-reload")&&(t.items=_(".nmgr-items-table :input[name]").serialize()),_.post(nmgr_global_params.ajax_url,t,function(t){t.success?(i.wishlist=t.data.wishlist,_(i.container).replaceWith(_(t.data.html)),i.reloaded(),_(document.body).trigger("nmgr_removed_from_wishlist")):t.error&&window.alert(t.data.notice)})),!1},save_items:function(){var t={items:_(".nmgr-items-table :input[name]").serialize(),action:"nmgr_save_items",wishlist_id:_(i.container).attr("data-wishlist-id"),_wpnonce:_(i.container).attr("data-nonce"),nmgr_global:JSON.stringify(nmgr_global_params.global)};return nmgr.block(i.container),_.post(nmgr_global_params.ajax_url,t,function(t){t.success&&(i.wishlist=t.data.wishlist,_(i.container).replaceWith(_(t.data.html)),i.reloaded()),nmgr.unblock(i.container)}),!1},add_items_action:function(){_(this).attr("data-url")?nmgr.go_to(_(this).attr("data-url")):_(this).attr("data-target")&&(new BSN.Modal(_(this).attr("data-target")).show(),i.reset_add_items_form(_(this).attr("data-target")),_(document.body).trigger("nmgr-select2-init"))},reset_add_items_form:function(t){void 0!==t&&(_(t).find("tr.added-row").remove(),_(t).find("form").trigger("reset").find(":input").each(function(){_(this).is(".nmgr-product-search")&&_(this).val("")}))},new_add_items_row:function(){var t,e;_(this).closest("tr").is(":last-child")&&(e=(t=_(this).closest("table").find("tbody")).find("tr").length,e=t.data("row").replace(/\[0\]/g,"["+e+"]"),t.append('<tr class="added-row">'+e+"</tr>"),_(document.body).trigger("nmgr-select2-init"))},add_items:function(){var t=_(this).closest(".nmgr-add-items").find("table tbody").find("tr"),n=[];_(t).each(function(){var t=_(this).find(':input[name="item_id"]').val(),e=_(this).find(':input[name="item_qty"]').val(),a=_(this).find(':input[name="item_fav"]').val();n.push({id:t,qty:e||1,fav:a})});t="#"+_(this).closest(".modal").attr("id");new BSN.Modal(t),nmgr.block(i.container);t={action:"nmgr_add_item",wishlist_id:_(i.container).attr("data-wishlist-id"),nmgr_global:JSON.stringify(nmgr_global_params.global),data:n};"true"===_("#nmgr-items button.save-action").attr("data-reload")&&(t.items=_(".nmgr-items-table :input[name]").serialize()),_.ajax({type:"POST",url:nmgr_global_params.ajax_url,data:t,dataType:"json",success:function(t){t.success?(_(i.container).replaceWith(t.data.html),i.reloaded()):(nmgr.unblock(i.container),window.alert(t.data.error))}})},add_to_cart:function(t){var e=_(this),a=e.closest(".nmgr-add-to-cart-form");if(!e.is(".nmgr_ajax_add_to_cart"))return!0;t.preventDefault();var n={action:"nmgr_add_to_cart"},t=a.serializeArray();_(t).each(function(t,e){n[e.name]=e.value}),e.removeClass("added"),e.addClass("loading"),_.post(nmgr_global_params.ajax_url,n,function(t){t&&(_(".woocommerce-error, .woocommerce-message, .woocommerce-info").remove(),e.removeClass("loading"),t.notice&&nmgr.show_notice(t.notice),t.success&&_(document.body).trigger("nmgr_added_to_cart",[a]))})},maybe_make_table_responsive:function(t,e){_(e).is("#nmgr-tab-items")&&nmgr.make_table_responsive(".nmgr-items-table")}};i.init();var t={init:function(){try{_(document.body).on("nmgr-select2-init",this.activate_select2).trigger("nmgr-select2-init")}catch(t){window.console.log(t)}},activate_select2:function(){t.select2_user_search(),t.select2_product_search()},select2_product_search:function(){_(":input.nmgr-product-search").each(function(){var t={allowClear:!!_(this).data("allow_clear"),placeholder:_(this).data("placeholder"),minimumInputLength:_(this).data("minimum_input_length")?_(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:nmgr_global_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:"nmgr_json_search_products",security:nmgr_admin_params.search_products_nonce,exclude:_(this).data("exclude"),exclude_type:_(this).data("exclude_type"),include:_(this).data("include"),limit:_(this).data("limit"),display_stock:_(this).data("display_stock")}},processResults:function(t){var a=[];return t&&_.each(t,function(t,e){a.push({id:t,text:e})}),{results:a}},cache:!0}};_(this).select2(t)})},select2_user_search:function(){_(":input.nmgr-user-search").each(function(){var t={allowClear:!!_(this).data("allow_clear"),placeholder:_(this).data("placeholder"),minimumInputLength:_(this).data("minimum_input_length")?_(this).data("minimum_input_length"):"1",escapeMarkup:function(t){return t},ajax:{url:nmgr_global_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:"nmgr_json_search_users",security:nmgr_admin_params.search_users_nonce,exclude:_(this).data("exclude")}},processResults:function(t){var a=[];return t&&_.each(t,function(t,e){a.push({id:t,text:e})}),{results:a}},cache:!0}};_(this).select2(t)})}};t.init();var e={selector:{ship_to:"#nmgr_ship_to_account_address",user_id:"#nmgr_user_id"},init:function(){if("undefined"==typeof nmgr_admin_params)return!1;this.maybe_hide_ship_to_account_address_field(),this.toggle_fieldsets(),_(this.selector.user_id).on("change",this.maybe_hide_ship_to_account_address_field),_(this.selector.ship_to).on("change",this.maybe_toggle_fieldsets)},maybe_hide_ship_to_account_address_field:function(){isNaN(_(e.selector.user_id).val())?_(e.selector.ship_to).prop("disabled",!0):_(e.selector.ship_to).prop("disabled",!1)},maybe_toggle_fieldsets:function(){if(_(this).is(":checked")){if(!_(e.selector.user_id).val())return alert(nmgr_admin_params.i18n_select_user),_(this).prop("checked",!1),!1;if(!window.confirm(nmgr_admin_params.i18n_use_account_shipping_address_text))return _(this).prop("checked",!1),!1}e.toggle_fieldsets()},toggle_fieldsets:function(){_(this.selector.ship_to).is(":checked")?(_(".account-shipping-address").slideDown(),_(".wishlist-shipping-address").hide()):(_(".account-shipping-address").slideUp(),_(".wishlist-shipping-address").slideDown())}};e.init(),nmgr.init_datepicker();var g={states:null,init:function(){"undefined"!=typeof nmgr_admin_params&&void 0!==nmgr_admin_params.countries&&(this.states=_.parseJSON(nmgr_admin_params.countries.replace(/&quot;/g,'"'))),_(".js_field-country").selectWoo().change(this.change_country),_(".js_field-country").trigger("change",[!0]),_(document.body).on("change","select.js_field-state",this.change_state)},change_country:function(t,e){var a,n,i,r,s,o,d,l,c,m;void 0===e&&(e=!1),null!==g.states&&(c=(a=_(this)).val(),i=(n=a.parents("div.nmgr-shipping-fields").find(":input.js_field-state")).parent(),r=n.attr("name"),s=n.attr("id"),o=a.data("woocommerce.stickState-"+c)?a.data("woocommerce.stickState-"+c):n.val(),d=n.attr("placeholder"),e&&a.data("woocommerce.stickState-"+c,o),i.show().find(".select2-container").remove(),_.isEmptyObject(g.states[c])?(m=_('<input type="text" />').prop("id",s).prop("name",r).prop("placeholder",d).addClass("js_field-state").val(""),n.replaceWith(m)):(l=g.states[c],c=_('<option value=""></option>').text(nmgr_admin_params.i18n_select_state_text),m=_("<select></select>").prop("id",s).prop("name",r).prop("placeholder",d).addClass("js_field-state select short").append(c),_.each(l,function(t){t=_("<option></option>").prop("value",t).text(l[t]);m.append(t)}),m.val(o),n.replaceWith(m),m.show().selectWoo().hide().change()))},change_state:function(){var t=_(this),e=t.val(),a=t.parents("div.nmgr-shipping-fields").find(":input.js_field-country"),t=a.val();a.data("woocommerce.stickState-"+t,e)}};g.init(),function(){var t=document.querySelectorAll("tr.type-nm_gift_registry td.column-author");if(t.length)for(var e=0;e<t.length;e++)t[e].innerText||(t[e].innerHTML='<div class="nmgr-post-author">'+nmgr_admin_params.i18n_guest_text+"</div>")}()});